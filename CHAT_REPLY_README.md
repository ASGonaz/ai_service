# ๐ ุชู ุฅูุดุงุก Chat Reply Endpoint ุจูุฌุงุญ!

## โ ูุง ุชู ุฅูุฌุงุฒู

ุชู ุฅูุดุงุก endpoint ุฌุฏูุฏ `/api/v1/chat/reply` ูููู ุจุชูููุฏ ุฑุฏ ุนูู ุฑุณุงูุฉ ูุญุฏุฏุฉ ุจุฏูุงู ูู ุงููุฑุณู ุงูุฃุตูู.

## ๐ ุงููููุงุช ุงููุนุฏูุฉ ูุงููุถุงูุฉ

### ูููุงุช ูุนุฏูุฉ:
1. **`controllers/chatController.js`**
   - โ ุฅุถุงูุฉ ุฏุงูุฉ `buildReplyPrompt()` - ูุจูุงุก prompt ูุฎุตุต
   - โ ุฅุถุงูุฉ ุฏุงูุฉ `generateMessageReply()` - ูุชูููุฏ ุงูุฑุฏ

2. **`routes/chatRoutes.js`**
   - โ ุฅุถุงูุฉ route ุฌุฏูุฏ `POST /reply`

### ูููุงุช ุฌุฏูุฏุฉ:
3. **`docs/CHAT_REPLY_ENDPOINT.md`** - ุชูุซูู ูุงูู ููู endpoint
4. **`docs/CHAT_REPLY_UPDATE_SUMMARY.md`** - ููุฎุต ุงูุชุญุฏูุซุงุช
5. **`examples/chat-reply-example.js`** - ุฃูุซูุฉ ุนูู ุงูุงุณุชุฎุฏุงู
6. **`tests/test-chat-reply.js`** - ุงุฎุชุจุงุฑุงุช ููู endpoint

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงูุทูุจ (Request)
```http
POST /api/v1/chat/reply
Content-Type: application/json

{
  "roomId": "room_123",
  "senderId": "user_456",
  "messageId": "msg_789"
}
```

### ุงูุงุณุชุฌุงุจุฉ (Response)
```json
{
  "success": true,
  "answer": "ุงูุฑุฏ ุงููููุฏ ุนูู ุงูุฑุณุงูุฉ",
  "suggestedAnswer": "ุฑุฏ ุจุฏูู ุฃูุตุฑ",
  "targetMessage": {
    "id": "msg_789",
    "sender_id": "original_sender",
    "sender_name": "ุงุณู ุงููุฑุณู",
    "message_text": "ูุต ุงูุฑุณุงูุฉ ุงูุฃุตููุฉ",
    "createdAt": "2025-11-28T12:00:00Z"
  },
  "metadata": {
    "generationTime": "500ms",
    "totalTime": "750ms",
    "provider": "openai",
    "model": "gpt-4"
  }
}
```

## ๐ ุงููุนููุงุช ุงููุทููุจุฉ

| ุงููุนููุฉ | ุงูููุน | ุงููุตู |
|---------|------|-------|
| `roomId` | string | ูุนุฑู ุงูุบุฑูุฉ ุงูุชู ุชุญุชูู ุนูู ุงูุฑุณุงูุฉ |
| `senderId` | string | ูุนุฑู ุงููุฑุณู ุงูุฐู ุณูุชู ุงูุฑุฏ ุจุฏูุงู ููู |
| `messageId` | string | ูุนุฑู ุงูุฑุณุงูุฉ ุงููุทููุจ ุงูุฑุฏ ุนูููุง (ูู `payload.message_id`) |

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **`messageId` ูุฌุจ ุฃู ูููู ูู `payload.message_id`** ูููุณ Qdrant UUID
2. **ุงูุฑุฏ ูุง ูุชู ุญูุธู** ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุนูู ุนูุณ `/chat`)
3. **ูุง ูุณุชุฎุฏู AI chat history** - ููุท ุฑุณุงุฆู ุงูุบุฑูุฉ ูุงูุณูุงู
4. **ูุฑุฏ ุจููุณ ุงููุบุฉ** ูุงูุฃุณููุจ ุงููุณุชุฎุฏู ูู ุงูุฑุณุงูุฉ ุงูุฃุตููุฉ

## ๐ ุงููุฑู ุจูู `/chat` ู `/reply`

| ุงูููุฒุฉ | `/chat` | `/reply` |
|--------|---------|----------|
| **ุงููุฏู** | ุงูุฑุฏ ุนูู ุณุคุงู ุงููุณุชุฎุฏู | ุงูุฑุฏ ุนูู ุฑุณุงูุฉ ูุญุฏุฏุฉ |
| **ุงููุฏุฎูุงุช** | `userQuestion` | `messageId` |
| **ุงูุณูุงู** | AI chat history + ุฑุณุงุฆู ุงูุบุฑูุฉ | ุฑุณุงุฆู ุงูุบุฑูุฉ ููุท |
| **ุงูุญูุธ** | ูุญูุธ ูู AI chat history | ูุง ูุญูุธ |
| **Prompt** | prompt ุนุงู | prompt ูุฎุตุต ููุฑุณุงูุฉ |
| **System Prompt** | "ููุฌู" ูุนุถู | AI ูุฑุฏ ุจุฏูุงู ูู ุงููุฑุณู |

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ูุฏูู:
```bash
curl -X POST http://localhost:3000/api/v1/chat/reply \
  -H "Content-Type: application/json" \
  -d '{
    "roomId": "your_room_id",
    "senderId": "your_sender_id",
    "messageId": "your_message_id"
  }'
```

### ุงุฎุชุจุงุฑ ุขูู:
```bash
node tests/test-chat-reply.js
```

## ๐ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

| ููุฏ ุงูุฎุทุฃ | ุงููุตู | ุงูุฑุณุงูุฉ |
|-----------|-------|---------|
| **400** | ูุนูููุงุช ูุงูุตุฉ | "Missing required fields: roomId, senderId, and messageId are required" |
| **404** | ุงูุฑุณุงูุฉ ุบูุฑ ููุฌูุฏุฉ | "ุงูุชุธุฑ ูุญุงูู ุจุนุฏ ูุญุธุงุช" |
| **500** | ุฎุทุฃ ูู ุงูุชูููุฏ | "Failed to generate message reply" |

## ๐ ุงูุชูุซูู ุงููุงูู

ูููุฒูุฏ ูู ุงูุชูุงุตููุ ุฑุงุฌุน:
- **`docs/CHAT_REPLY_ENDPOINT.md`** - ุชูุซูู ูุงูู
- **`examples/chat-reply-example.js`** - ุฃูุซูุฉ ุนูู ุงูุงุณุชุฎุฏุงู
- **`tests/test-chat-reply.js`** - ุงุฎุชุจุงุฑุงุช

## โ ุงูุชุญูู ูู ุงูููุฏ

ุชู ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก syntax:
```bash
โ node --check controllers/chatController.js
โ node --check routes/chatRoutes.js
```

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุชุดุบูู ุงูุณูุฑูุฑ**: `npm run dev`
2. **ุงุฎุชุจุงุฑ ุงูู endpoint**: ุงุณุชุฎุฏู curl ุฃู Postman
3. **ูุฑุงุฌุนุฉ ุงูุชูุซูู**: ุงูุฑุฃ `docs/CHAT_REPLY_ENDPOINT.md`
4. **ุชุฌุฑุจุฉ ุงูุฃูุซูุฉ**: ุฑุงุฌุน `examples/chat-reply-example.js`

---

**ุชู ุงูุฅูุฌุงุฒ ุจูุฌุงุญ! ๐**

ุงูู endpoint ุฌุงูุฒ ููุงุณุชุฎุฏุงู ููุนูู ุจุดูู ูุงูู.
