# ููุฎุต ุงูุชุญุฏูุซุงุช - Chat Reply Endpoint

## ูุง ุชู ุฅูุฌุงุฒู

ุชู ุฅูุดุงุก endpoint ุฌุฏูุฏ `/api/v1/chat/reply` ููุฑุฏ ุนูู ุฑุณุงูุฉ ูุญุฏุฏุฉ ุจุฏูุงู ูู ุงููุฑุณู ุงูุฃุตูู.

## ุงููููุงุช ุงููุนุฏูุฉ

### 1. `controllers/chatController.js`
- โ ุฅุถุงูุฉ ุฏุงูุฉ `buildReplyPrompt()` ูุจูุงุก prompt ูุฎุตุต ููุฑุฏ ุนูู ุฑุณุงูุฉ ูุญุฏุฏุฉ
- โ ุฅุถุงูุฉ ุฏุงูุฉ `generateMessageReply()` ูุชูููุฏ ุงูุฑุฏ ุจุงุณุชุฎุฏุงู AI

### 2. `routes/chatRoutes.js`
- โ ุฅุถุงูุฉ route ุฌุฏูุฏ `POST /reply` ููุชุนุงูู ูุน ุทูุจุงุช ุงูุฑุฏ ุนูู ุงูุฑุณุงุฆู

### 3. `docs/CHAT_REPLY_ENDPOINT.md`
- โ ุชูุซูู ูุงูู ููู endpoint ุงูุฌุฏูุฏ

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### Request
```http
POST /api/v1/chat/reply
Content-Type: application/json

{
  "roomId": "room_123",
  "senderId": "user_456",
  "messageId": "msg_789"
}
```

### Response
```json
{
  "success": true,
  "answer": "ุงูุฑุฏ ุงููููุฏ",
  "suggestedAnswer": "ุฑุฏ ุจุฏูู ุฃูุตุฑ",
  "targetMessage": {
    "id": "msg_789",
    "sender_id": "user_original",
    "sender_name": "ุงุณู ุงููุฑุณู",
    "message_text": "ูุต ุงูุฑุณุงูุฉ ุงูุฃุตููุฉ",
    "createdAt": "2025-11-28T12:00:00Z"
  },
  "metadata": {
    "generationTime": "500ms",
    "totalTime": "750ms"
  }
}
```

## ุงููุฑููุงุช ุงูุฑุฆูุณูุฉ ุนู `/chat`

| ุงูููุฒุฉ | `/chat` | `/reply` |
|--------|---------|----------|
| **ุงููุฏู** | ุงูุฑุฏ ุนูู ุณุคุงู ุงููุณุชุฎุฏู | ุงูุฑุฏ ุนูู ุฑุณุงูุฉ ูุญุฏุฏุฉ ุจุฏูุงู ูู ุงููุฑุณู |
| **ุงููุฏุฎูุงุช** | `userQuestion` | `messageId` |
| **ุงูุณูุงู** | ูุญุงุฏุซุงุช AI ุงูุณุงุจูุฉ + ุฑุณุงุฆู ุงูุบุฑูุฉ | ุฑุณุงุฆู ุงูุบุฑูุฉ ููุท (ุจุฏูู AI chat history) |
| **ุงูุญูุธ** | ูุญูุธ ูู AI chat history | ูุง ูุญูุธ |
| **Prompt** | prompt ุนุงู ูููุญุงุฏุซุฉ | prompt ูุฎุตุต ููุฑุฏ ุนูู ุฑุณุงูุฉ |
| **System Prompt** | "ููุฌู" ูุนุถู ูู ุงูุบุฑูุฉ | AI ูุฑุฏ ุจุฏูุงู ูู ุงููุฑุณู |

## ุขููุฉ ุงูุนูู

1. **ุงูุจุญุซ ุนู ุงูุฑุณุงูุฉ**: ูุจุญุซ ูู Qdrant ุนู ุงูุฑุณุงูุฉ ุจุงุณุชุฎุฏุงู `message_id` ู `room_id`
2. **ุฌูุจ ุงูุณูุงู**: 
   - ููุฎุต ุงูุบุฑูุฉ (room summary)
   - ูุนูููุงุช ุงููุฑุณู (user personalization)
   - ุขุฎุฑ 15 ุฑุณุงูุฉ ูู ุงูุบุฑูุฉ
3. **ุจูุงุก Prompt**: ูุจูู prompt ูุฎุตุต ูุฑูุฒ ุนูู ุงูุฑุณุงูุฉ ุงููุญุฏุฏุฉ
4. **ุชูููุฏ ุงูุฑุฏ**: ูุณุชุฎุฏู AI ูุชูููุฏ ุฑุฏ ููุงุณุจ ูุน ูุฑุงุนุงุฉ:
   - ุงูุณูุงู ุงููุงูู
   - ุงููุบุฉ ูุงูุฃุณููุจ
   - ุงูุทุจูุนูุฉ ูุงูุชูุงุณู
5. **ุงูุฅุฑุฌุงุน**: ูุฑุฌุน ุงูุฑุฏ ุจุฏูู ุญูุธู

## ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

- โ **400**: ุฅุฐุง ูุงูุช ุงููุนูููุงุช ุงููุทููุจุฉ ูุงูุตุฉ
- โ **404**: ุฅุฐุง ูู ูุชู ุงูุนุซูุฑ ุนูู ุงูุฑุณุงูุฉ โ "ุงูุชุธุฑ ูุญุงูู ุจุนุฏ ูุญุธุงุช"
- โ **500**: ุฃุฎุทุงุก ุฃุฎุฑู ูู ุงูุชูููุฏ

## ููุงุญุธุงุช ูููุฉ

- โ๏ธ `messageId` ูุฌุจ ุฃู ูููู ูู `payload.message_id` ูููุณ Qdrant UUID
- ๐ ุงูุฑุฏ ูุง ูุชู ุญูุธู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุนูู ุนูุณ `/chat`)
- ๐ฏ AI ูุฑูุฒ ุนูู ุงูุฑุณุงูุฉ ุงููุญุฏุฏุฉ ููุท
- ๐ AI ูุฑุฏ ุจููุณ ุงููุบุฉ ูุงูุฃุณููุจ ุงููุณุชุฎุฏู ูู ุงูุฑุณุงูุฉ
- โฑ๏ธ ูุง ูุณุชุฎุฏู AI chat history (ูุฃูู ุฑุฏ ุนูู ุฑุณุงูุฉ ูููุณ ูุญุงุฏุซุฉ)

## ุงูุงุฎุชุจุงุฑ

ููููู ุงุฎุชุจุงุฑ ุงูู endpoint ุจุงุณุชุฎุฏุงู:

```bash
curl -X POST http://localhost:3000/api/v1/chat/reply \
  -H "Content-Type: application/json" \
  -d '{
    "roomId": "your_room_id",
    "senderId": "your_sender_id",
    "messageId": "your_message_id"
  }'
```

## ุงูุชุญูู ูู ุงูููุฏ

ุชู ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก syntax:
```bash
node --check controllers/chatController.js  # โ OK
node --check routes/chatRoutes.js           # โ OK
```
